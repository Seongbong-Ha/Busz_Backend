<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚌 Busz 백엔드 통합 테스트</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='websocket_test.css') }}">
</head>
<body>
    <div class="container">
        <h1>🚌 Busz 백엔드 통합 테스트</h1>
        
        <!-- 플로우 1: WebSocket 실시간 모니터링 -->
        <div class="flow-section flow1-section">
            <div class="flow-title">
                <span class="connection-indicator" id="connectionIndicator"></span>
                플로우 1: WebSocket 실시간 모니터링
            </div>
            
            <div class="input-group">
                <label for="lat">위도:</label>
                <input type="number" id="lat" placeholder="위도" value="37.497928" step="any">
            </div>
            
            <div class="input-group">
                <label for="lng">경도:</label>
                <input type="number" id="lng" placeholder="경도" value="127.027583" step="any">
            </div>
            
            <div class="input-group">
                <label for="busNumber">버스 번호:</label>
                <input type="text" id="busNumber" placeholder="버스번호" value="9201">
            </div>
            
            <div class="input-group">
                <label for="interval">업데이트 간격(초):</label>
                <input type="number" id="interval" placeholder="간격(초)" value="30" min="10" max="300">
            </div>
            
            <div class="button-group">
                <button onclick="startFlow1()" id="startBtn" class="btn-primary">🚀 플로우 1 시작</button>
                <button onclick="stopFlow1()" id="stopBtn" class="btn-danger" disabled>⏹️ 플로우 1 중단</button>
                <button onclick="getFlow1Status()" class="btn-secondary">📊 상태 확인</button>
            </div>
            
            <div id="flow1Status" class="status stopped">플로우 1 대기 중...</div>
        </div>
        
        <!-- 플로우 2: REST API 전체 버스 정보 -->
        <div class="flow-section flow2-section">
            <div class="flow-title">🔗 플로우 2: REST API 전체 버스 정보</div>
            
            <p><strong>사용법:</strong> 플로우 1을 먼저 시작한 후, 플로우 2를 호출하세요.</p>
            
            <div class="button-group">
                <button onclick="callFlow2()" id="flow2Btn" class="btn-success">📋 플로우 2 호출</button>
                <button onclick="testFlow2Direct()" class="btn-secondary">🧪 직접 테스트 (세션 없이)</button>
            </div>
            
            <div id="flow2Status" class="status stopped">플로우 2 대기 중...</div>
            
            <div id="flow2Result" style="display: none;">
                <h4>플로우 2 응답 결과:</h4>
                <div id="flow2Json" class="json-display"></div>
            </div>
        </div>
        
        <!-- 통합 로그 -->
        <div class="updates-section">
            <h3>실시간 로그</h3>
            <div class="button-group">
                <button onclick="clearUpdates()" class="btn-secondary">🗑️ 로그 지우기</button>
                <button onclick="exportLogs()" class="btn-secondary">💾 로그 저장</button>
            </div>
            <div id="updates"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='websocket_test.js') }}"></script>
</body>
</html>